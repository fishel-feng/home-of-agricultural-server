{"version":3,"sources":["../../../app/service/io.js"],"names":["module","exports","SOCKET","IOService","token","userId","ctx","app","jwt","verify","socketId","socket","id","redis","set","to","message","get","targetSocketId","nsp","sockets","emit","Service"],"mappings":"AAAA;;;;;;;;;;;;AAEAA,OAAOC,OAAP,GAAiB,eAAO;AACtB,MAAMC,SAAS,QAAf;;AADsB,MAEhBC,SAFgB;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;;AAIpB;;;;;AAJoB;AAAA,4FASRC,KATQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAUZC,wBAVY,GAUH,KAAKC,GAAL,CAASC,GAAT,CAAaC,GAAb,CAAiBC,MAAjB,CAAwBL,KAAxB,EAA+B,QAA/B,EAAyCC,MAVtC;AAWZK,0BAXY,GAWD,KAAKJ,GAAL,CAASK,MAAT,CAAgBC,EAXf;AAAA;AAAA,yBAYZL,IAAIM,KAAJ,CAAUC,GAAV,CAAcZ,SAASG,MAAvB,EAA+BK,QAA/B,CAZY;;AAAA;AAAA,mDAaXA,QAbW;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8FAgBTK,EAhBS,EAgBLC,OAhBK;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBZX,wBAjBY,GAiBH,0BAjBG;AAAA;AAAA,yBAkBWE,IAAIM,KAAJ,CAAUI,GAAV,CAAcf,SAASa,EAAvB,CAlBX;;AAAA;AAkBZG,gCAlBY;;AAmBlB,sBAAIA,cAAJ,EAAoB;AAClB,yBAAKZ,GAAL,CAASK,MAAT,CAAgBQ,GAAhB,CAAoBC,OAApB,CAA4BF,cAA5B,EAA4CG,IAA5C,CAAiD,SAAjD,EAA4DhB,MAA5D,EAAoEW,OAApE;AACD;;AArBiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,IAEET,IAAIe,OAFN;;AA4BtB,SAAOnB,SAAP;AACD,CA7BD","file":"io.js","sourcesContent":["'use strict';\n\nmodule.exports = app => {\n  const SOCKET = 'SOCKET';\n  class IOService extends app.Service {\n\n    /**\n     * 登录\n     * @param {String} token token\n     * @return {Promise<void>} id\n     */\n    async login(token) {\n      const userId = this.ctx.app.jwt.verify(token, '123456').userId;\n      const socketId = this.ctx.socket.id;\n      await app.redis.set(SOCKET + userId, socketId);\n      return socketId;\n    }\n\n    async chat(to, message) {\n      const userId = '5a16699d5e58179af45247d0';\n      const targetSocketId = await app.redis.get(SOCKET + to);\n      if (targetSocketId) {\n        this.ctx.socket.nsp.sockets[targetSocketId].emit('message', userId, message);\n      }\n    }\n\n    async like() {\n      //\n    }\n  }\n  return IOService;\n};\n"]}