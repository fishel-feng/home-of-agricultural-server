{"version":3,"sources":["../../../app/controller/user.js"],"names":["Controller","require","module","exports","ctx","validate","tel","password","code","request","body","service","user","signUp","token","signIn","resetPassword","status","reset","type","required","sendVerifyCode","nickName","allowEmpty","gender","age","job","location","description","headImage","modifyUserInfo","targetId","giveFollow","cancelFollow","userId","params","getUserInfo","getUserIndex","getCollections","collections","last","getAttentions","attentions","questions","getFollowings","followings","getFollowers","followers","getQuestions","getAnswers","answers","getCircles","circles","circleList","showMessage","messages","getRecent","recent"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\n\nconst Controller = require('egg').Controller;\n\nmodule.exports = class UserController extends Controller {\n\n  /**\n   * 用户注册\n   */\n  async signUp() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n      code: /^\\d{6}$/,\n    });\n    const {\n      tel,\n      password,\n      code,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signUp(tel, password, code);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 用户登录\n   */\n  async signIn() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      password,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signIn(tel, password);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 重置密码\n   */\n  async resetPassword() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      code: /^\\d{6}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      code,\n      password,\n    } = this.ctx.request.body;\n    const status = await this.service.user.resetPassword(tel, code, password);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 发送验证码\n   */\n  async sendVerifyCode() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      reset: {\n        type: 'boolean',\n        required: false,\n      },\n    });\n    const {\n      tel,\n      reset,\n    } = this.ctx.request.body;\n    const status = await this.service.user.sendVerifyCode(tel, reset);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 修改用户信息\n   */\n  async modifyUserInfo() {\n    this.ctx.validate({\n      nickName: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      gender: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      age: {\n        type: 'integer',\n        required: true,\n        allowEmpty: true,\n      },\n      job: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      location: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      description: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      headImage: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n    });\n    const {\n      nickName,\n      gender,\n      age,\n      job,\n      location,\n      description,\n      headImage,\n    } = this.ctx.request.body;\n    const status = await this.ctx.service.user.modifyUserInfo(nickName, gender, age, job, location, description, headImage);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 关注用户\n   */\n  async giveFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.giveFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 取消关注用户\n   */\n  async cancelFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.cancelFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 获取用户信息\n   */\n  async getUserInfo() {\n    const userId = this.ctx.params.userId;\n    const user = await this.service.user.getUserInfo(userId);\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看我的信息\n   */\n  async getUserIndex() {\n    const user = await this.service.user.getUserIndex();\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看收藏的文章列表\n   */\n  async getCollections() {\n    const collections = await this.service.user.getCollections();\n    this.ctx.body = {\n      collections,\n    };\n  }\n\n  /**\n   * 查看关注的问题列表\n   */\n  async getAttentions() {\n    const last = this.ctx.params.last;\n    const attentions = await this.service.user.getAttentions(last);\n    this.ctx.body = {\n      questions: attentions,\n    };\n  }\n\n  /**\n   * 查看关注的人列表\n   */\n  async getFollowings() {\n    const followings = await this.service.user.getFollowings();\n    this.ctx.body = {\n      followings,\n    };\n  }\n\n  /**\n   * 查看关注我的人列表\n   */\n  async getFollowers() {\n    const followers = await this.service.user.getFollowers();\n    this.ctx.body = {\n      followers,\n    };\n  }\n\n  /**\n   * 查看我的提问记录\n   */\n  async getQuestions() {\n    const last = this.ctx.params.last;\n    const questions = await this.service.user.getQuestions(last);\n    this.ctx.body = {\n      questions,\n    };\n  }\n\n  /**\n   * 查看我的回答记录\n   */\n  async getAnswers() {\n    const last = this.ctx.params.last;\n    const answers = await this.service.user.getAnswers(last);\n    this.ctx.body = {\n      questions: answers,\n    };\n  }\n\n  /**\n   * 查看我发表的动态\n   */\n  async getCircles() {\n    const last = this.ctx.params.last;\n    const circles = await this.service.user.getCircles(last);\n    this.ctx.body = {\n      circleList: circles,\n    };\n  }\n\n  /**\n   * 查看我收到的消息\n   */\n  async showMessage() {\n    const messages = await this.service.user.showMessage();\n    this.ctx.body = {\n      messages,\n    };\n  }\n\n  /**\n   * 查看最近联系的人\n   */\n  async getRecent() {\n    const recent = await this.service.user.getRecent();\n    this.ctx.body = {\n      recent,\n    };\n  }\n};\n"]}