{"version":3,"sources":["../../../app/controller/user.js"],"names":["Controller","require","UserController","ctx","validate","tel","password","code","request","body","service","user","signUp","token","signIn","resetPassword","status","reset","type","required","sendVerifyCode","nickName","allowEmpty","gender","age","job","location","description","modifyUserInfo","parts","multipart","autoFields","upload","images","modifyHeadImage","targetId","giveFollow","cancelFollow","userId","params","getUserInfo","getUserIndex","getCollections","collections","last","getAttentions","attentions","questions","getFollowings","followings","getFollowers","followers","getQuestions","getAnswers","answers","getCircles","circles","circleList","showMessage","messages","getRecent","recent","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n\n  /**\n   * 用户注册\n   */\n  async signUp() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n      code: /^\\d{6}$/,\n    });\n    const {\n      tel,\n      password,\n      code,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signUp(tel, password, code);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 用户登录\n   */\n  async signIn() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      password,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signIn(tel, password);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 重置密码\n   */\n  async resetPassword() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      code: /^\\d{6}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      code,\n      password,\n    } = this.ctx.request.body;\n    const status = await this.service.user.resetPassword(tel, code, password);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 发送验证码\n   */\n  async sendVerifyCode() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      reset: {\n        type: 'boolean',\n        required: false,\n      },\n    });\n    const {\n      tel,\n      reset,\n    } = this.ctx.request.body;\n    const status = await this.service.user.sendVerifyCode(tel, reset);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 修改用户信息\n   */\n  async modifyUserInfo() {\n    this.ctx.validate({\n      nickName: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      gender: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      age: {\n        type: 'integer',\n        required: true,\n        allowEmpty: true,\n      },\n      job: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      location: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      description: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n    });\n    const {\n      nickName,\n      gender,\n      age,\n      job,\n      location,\n      description,\n    } = this.ctx.request.body;\n    const status = await this.ctx.service.user.modifyUserInfo(nickName, gender, age, job, location, description);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 修改用户头像\n   */\n  async modifyHeadImage() {\n    const parts = this.ctx.multipart({\n      autoFields: true,\n    });\n    const images = await this.service.upload.upload(parts, 'headImage');\n    const status = await this.service.user.modifyHeadImage(images[0]);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 关注用户\n   */\n  async giveFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.giveFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 取消关注用户\n   */\n  async cancelFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.cancelFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 获取用户信息\n   */\n  async getUserInfo() {\n    const userId = this.ctx.params.userId;\n    const user = await this.service.user.getUserInfo(userId);\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看我的信息\n   */\n  async getUserIndex() {\n    const user = await this.service.user.getUserIndex();\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看收藏的文章列表\n   */\n  async getCollections() {\n    const collections = await this.service.user.getCollections();\n    this.ctx.body = collections;\n  }\n\n  /**\n   * 查看关注的问题列表\n   */\n  async getAttentions() {\n    const last = this.ctx.params.last;\n    const attentions = await this.service.user.getAttentions(last);\n    this.ctx.body = {\n      questions: attentions,\n    };\n  }\n\n  /**\n   * 查看关注的人列表\n   */\n  async getFollowings() {\n    const followings = await this.service.user.getFollowings();\n    this.ctx.body = {\n      followings,\n    };\n  }\n\n  /**\n   * 查看关注我的人列表\n   */\n  async getFollowers() {\n    const followers = await this.service.user.getFollowers();\n    this.ctx.body = {\n      followers,\n    };\n  }\n\n  /**\n   * 查看我的提问记录\n   */\n  async getQuestions() {\n    const last = this.ctx.params.last;\n    const questions = await this.service.user.getQuestions(last);\n    this.ctx.body = {\n      questions,\n    };\n  }\n\n  /**\n   * 查看我的回答记录\n   */\n  async getAnswers() {\n    const last = this.ctx.params.last;\n    const answers = await this.service.user.getAnswers(last);\n    this.ctx.body = {\n      questions: answers,\n    };\n  }\n\n  /**\n   * 查看我发表的动态\n   */\n  async getCircles() {\n    const last = this.ctx.params.last;\n    const circles = await this.service.user.getCircles(last);\n    this.ctx.body = {\n      circleList: circles,\n    };\n  }\n\n  /**\n   * 查看我收到的消息\n   */\n  async showMessage() {\n    const messages = await this.service.user.showMessage();\n    this.ctx.body = {\n      messages,\n    };\n  }\n\n  /**\n   * 查看最近联系的人\n   */\n  async getRecent() {\n    const recent = await this.service.user.getRecent();\n    this.ctx.body = {\n      recent,\n    };\n  }\n}\n\nmodule.exports = UserController;\n"]}