{"version":3,"sources":["../../../app/controller/user.js"],"names":["Controller","require","UserController","ctx","validate","tel","password","code","request","body","service","user","signUp","token","signIn","resetPassword","status","reset","type","required","sendVerifyCode","nickName","allowEmpty","gender","age","job","location","description","headImage","modifyUserInfo","targetId","giveFollow","cancelFollow","userId","params","getUserInfo","getUserIndex","getCollections","collections","last","getAttentions","attentions","questions","getFollowings","followings","getFollowers","followers","getQuestions","getAnswers","answers","getCircles","circles","circleList","showMessage","messages","getRecent","recent","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["'use strict';\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n\n  /**\n   * 用户注册\n   */\n  async signUp() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n      code: /^\\d{6}$/,\n    });\n    const {\n      tel,\n      password,\n      code,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signUp(tel, password, code);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 用户登录\n   */\n  async signIn() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      password,\n    } = this.ctx.request.body;\n    const token = await this.service.user.signIn(tel, password);\n    this.ctx.body = {\n      token,\n    };\n  }\n\n  /**\n   * 重置密码\n   */\n  async resetPassword() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      code: /^\\d{6}$/,\n      password: 'string',\n    });\n    const {\n      tel,\n      code,\n      password,\n    } = this.ctx.request.body;\n    const status = await this.service.user.resetPassword(tel, code, password);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 发送验证码\n   */\n  async sendVerifyCode() {\n    this.ctx.validate({\n      tel: /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/,\n      reset: {\n        type: 'boolean',\n        required: false,\n      },\n    });\n    const {\n      tel,\n      reset,\n    } = this.ctx.request.body;\n    const status = await this.service.user.sendVerifyCode(tel, reset);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 修改用户信息\n   */\n  async modifyUserInfo() {\n    this.ctx.validate({\n      nickName: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      gender: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      age: {\n        type: 'integer',\n        required: true,\n        allowEmpty: true,\n      },\n      job: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      location: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      description: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n      headImage: {\n        type: 'string',\n        required: true,\n        allowEmpty: true,\n      },\n    });\n    const {\n      nickName,\n      gender,\n      age,\n      job,\n      location,\n      description,\n      headImage,\n    } = this.ctx.request.body;\n    const status = await this.ctx.service.user.modifyUserInfo(nickName, gender, age, job, location, description, headImage);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 关注用户\n   */\n  async giveFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.giveFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 取消关注用户\n   */\n  async cancelFollow() {\n    this.ctx.validate({\n      targetId: 'string',\n    });\n    const {\n      targetId,\n    } = this.ctx.request.body;\n    const status = await this.service.user.cancelFollow(targetId);\n    this.ctx.body = {\n      status,\n    };\n  }\n\n  /**\n   * 获取用户信息\n   */\n  async getUserInfo() {\n    const userId = this.ctx.params.userId;\n    const user = await this.service.user.getUserInfo(userId);\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看我的信息\n   */\n  async getUserIndex() {\n    const user = await this.service.user.getUserIndex();\n    this.ctx.body = {\n      user,\n    };\n  }\n\n  /**\n   * 查看收藏的文章列表\n   */\n  async getCollections() {\n    const collections = await this.service.user.getCollections();\n    this.ctx.body = collections;\n  }\n\n  /**\n   * 查看关注的问题列表\n   */\n  async getAttentions() {\n    const last = this.ctx.params.last;\n    const attentions = await this.service.user.getAttentions(last);\n    this.ctx.body = {\n      questions: attentions,\n    };\n  }\n\n  /**\n   * 查看关注的人列表\n   */\n  async getFollowings() {\n    const followings = await this.service.user.getFollowings();\n    this.ctx.body = {\n      followings,\n    };\n  }\n\n  /**\n   * 查看关注我的人列表\n   */\n  async getFollowers() {\n    const followers = await this.service.user.getFollowers();\n    this.ctx.body = {\n      followers,\n    };\n  }\n\n  /**\n   * 查看我的提问记录\n   */\n  async getQuestions() {\n    const last = this.ctx.params.last;\n    const questions = await this.service.user.getQuestions(last);\n    this.ctx.body = {\n      questions,\n    };\n  }\n\n  /**\n   * 查看我的回答记录\n   */\n  async getAnswers() {\n    const last = this.ctx.params.last;\n    const answers = await this.service.user.getAnswers(last);\n    this.ctx.body = {\n      questions: answers,\n    };\n  }\n\n  /**\n   * 查看我发表的动态\n   */\n  async getCircles() {\n    const last = this.ctx.params.last;\n    const circles = await this.service.user.getCircles(last);\n    this.ctx.body = {\n      circleList: circles,\n    };\n  }\n\n  /**\n   * 查看我收到的消息\n   */\n  async showMessage() {\n    const messages = await this.service.user.showMessage();\n    this.ctx.body = {\n      messages,\n    };\n  }\n\n  /**\n   * 查看最近联系的人\n   */\n  async getRecent() {\n    const recent = await this.service.user.getRecent();\n    this.ctx.body = {\n      recent,\n    };\n  }\n}\n\nmodule.exports = UserController;\n"]}